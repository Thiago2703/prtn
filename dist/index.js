!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["mail-proton-api"]=t():e["mail-proton-api"]=t()}(global,(function(){return(()=>{"use strict";var e={367:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.queryStringStringify=void 0,t.queryStringStringify=function(e){const t=[];for(const r in e)if(e.hasOwnProperty(r)){const n=e[r];if(void 0===n)continue;let o=encodeURIComponent(n);"boolean"==typeof n&&(o=n?"1":"0"),t.push(`${r}=${o}`)}return t.join("&")}},209:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomString=void 0;t.getRandomString=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=[];for(let n=0;n<e;n++)r.push(t[Math.floor(Math.random()*t.length)]);return r.join("")}},810:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};function n(e){return r(this,void 0,void 0,(function*(){return new Promise((t=>setTimeout(t,e)))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.RateLimiter=t.wait=void 0,t.wait=n;t.RateLimiter=class{constructor(){this.lastRequestTime=0}wait(){return r(this,void 0,void 0,(function*(){for(;Date.now()-this.lastRequestTime<1e3;)yield n(100);return this.lastRequestTime=Date.now(),!1}))}}},620:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(410),t),o(r(695),t),o(r(284),t),o(r(963),t),o(r(501),t)},695:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},49:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EventsRoutes=void 0;t.EventsRoutes=class{constructor(e){this.client=e}latest(){return r(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:"events/latest"})).data}))}get(e){return r(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:`events/${e}`})).data}))}}},410:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProtonmailClient=void 0;const i=r(549),s=o(r(376)),a=r(810),u=r(209),d=r(273),c=r(575),l=r(666),h=r(589),f=r(860),p=r(614),v=r(49),y=r(548);class m extends p.EventEmitter{constructor(e){super(),this.isloggedIn_=!1,this.refreshingToken_=!1,this.accessToken_="",this.refreshToken_="",this.pmUID_="",this.keysInfo_={publicKey:"",privateKey:"",passphrase:""},this.rateLimiter=new a.RateLimiter,this.options={domain:"mail.protonmail.com",rateLimit:!0,userAgent:"Mozilla/5.0 (Windows NT 6.1; rv:60.0) Gecko/20100101 Firefox/60.0"},this.users_=new l.UsersRoutes(this),this.keys_=new y.KeysRoutes(this),this.labels_=new h.LabelsRoutes(this),this.messages_=new f.MessagesRoutes(this),this.events_=new v.EventsRoutes(this),e&&("string"==typeof e.userAgent&&(this.options.userAgent=e.userAgent),"string"==typeof e.domain&&(this.options.domain=e.domain),"boolean"==typeof e.rateLimit&&(this.options.rateLimit=e.rateLimit)),this.axios=this.createAxiosInstance()}get pmUID(){return this.pmUID_}set pmUID(e){this.pmUID_=e,this.axios=this.createAxiosInstance()}get accessToken(){return this.accessToken_}set accessToken(e){this.accessToken_=e,this.axios=this.createAxiosInstance()}get refreshToken(){return this.refreshToken_}set refreshToken(e){this.refreshToken_=e}get users(){return this.users_}get keys(){return this.keys_}get labels(){return this.labels_}get messages(){return this.messages_}get events(){return this.events_}get isLoggedIn(){return this.isloggedIn_}createAxiosInstance(){const e=[].concat(s.default.defaults.transformResponse,(e=>e)),t={Accept:"application/vnd.protonmail.v1+json","User-Agent":this.options.userAgent,"x-pm-apiversion":"3","x-pm-appversion":"Other"};return"undefined"!=typeof window&&delete t["User-Agent"],""!==this.pmUID&&(t["x-pm-uid"]=this.pmUID),""!==this.accessToken&&(t.Authorization=`Bearer ${this.accessToken}`),s.default.create({transformResponse:e,baseURL:`https://${this.options.domain}/api/`,headers:t,withCredentials:!0})}request(e){return n(this,void 0,void 0,(function*(){for(this.options.rateLimit&&(yield this.rateLimiter.wait());this.refreshingToken_&&"auth/refresh"!==e.url;)yield a.wait(100);try{e.timeout=3e5;return yield this.axios.request(e)}catch(t){try{if(401===t.response.status&&"auth/refresh"!==e.url&&""!==this.refreshToken)return this.refreshingToken_||(this.refreshingToken_=!0,yield this.loginWithToken({RefreshToken:this.refreshToken,Uid:this.pmUID}),this.refreshingToken_=!1),this.request(e)}catch(e){e.response&&e.response.status>=400&&429!==e.response.status&&e.response.status<500&&(this.isloggedIn_=!1,this.emit("logout")),this.refreshingToken_=!1}throw t}}))}loginWithToken(e){return n(this,void 0,void 0,(function*(){this.pmUID=e.Uid;const t=yield this.authRefresh(e.RefreshToken,e.Uid);return this.accessToken=t.AccessToken,this.refreshToken=t.RefreshToken,this.pmUID=t.Uid,this.isloggedIn_=!0,this.emit("refresh_token_change"),t}))}fetchKeys(e){return n(this,void 0,void 0,(function*(){if(!this.isloggedIn_)throw new Error("You must login first");let t="",r="",n="",o="",s="";(yield this.keys.address()).Addresses.forEach((e=>{e.Keys.forEach((e=>{1===e.Primary&&(s=e.Token,n=e.PrivateKey,o=e.PublicKey)}))}));(yield this.keys.users()).User.Keys.forEach((e=>{1===e.Primary&&(t=e.ID,r=e.PrivateKey)}));let a="";(yield this.keys.keySalts()).KeySalts.forEach((e=>{e.ID===t&&(a=e.KeySalt)}));const u=yield c.computeKeyPassword(e.password,a),d=yield i.readKey({armoredKey:o}),l=yield i.decryptKey({privateKey:yield i.readPrivateKey({armoredKey:r}),passphrase:u}),h=yield i.readMessage({armoredMessage:s}),{data:f}=yield i.decrypt({message:h,decryptionKeys:l,verificationKeys:d});this.keysInfo_.privateKey=n,this.keysInfo_.publicKey=o,this.keysInfo_.passphrase=f}))}decryptMessage(e){return n(this,void 0,void 0,(function*(){const t=yield i.readKey({armoredKey:this.keysInfo_.publicKey}),r=yield i.decryptKey({privateKey:yield i.readPrivateKey({armoredKey:this.keysInfo_.privateKey}),passphrase:this.keysInfo_.passphrase}),n=yield i.readMessage({armoredMessage:e.Body}),{data:o}=yield i.decrypt({message:n,decryptionKeys:r,verificationKeys:t});return o}))}getTokenLoginInformation(){return{Uid:this.pmUID,RefreshToken:this.refreshToken}}login(e){return n(this,void 0,void 0,(function*(){const t=e.username.replace(/@.*$/g,""),r=yield this.authInfo(t),n=yield d.getSrp({Version:r.Version,Modulus:r.Modulus,ServerEphemeral:r.ServerEphemeral,Username:t,Salt:r.Salt},{password:e.loginPassword},r.Version),o={ClientProof:n.clientProof,ClientEphemeral:n.clientEphemeral,SRPSession:r.SRPSession,Username:t},i=yield this.auth(o);if(n.expectedServerProof!==i.ServerProof)throw new Error("Unexpected server proof");const s=i.AccessToken;if(/^-----BEGIN PGP MESSAGE-----/.test(s))throw new Error("Encrypted access tokens are not supported :^(");const a=1===i["2FA"].Enabled;if(a&&0===i["2FA"].TOTP)throw new Error("Unsupported 2FA type");if(a&&"string"!=typeof e.otpToken)throw new Error("2FA is enabled on the account so you have to provide a 2FA token");this.accessToken=s,this.refreshToken=i.RefreshToken,this.pmUID=i.Uid,this.emit("refresh_token_change"),a&&(yield this.auth2FA({TwoFactorCode:`${e.otpToken}`})),this.isloggedIn_=!0}))}logout(){return n(this,void 0,void 0,(function*(){const e=yield this.request({method:"delete",url:"auth"});return this.accessToken="",this.pmUID="",this.refreshToken="",e.data}))}authInfo(e){return n(this,void 0,void 0,(function*(){return(yield this.axios.post("auth/info",{Username:e})).data}))}auth(e){return n(this,void 0,void 0,(function*(){return(yield this.axios.post("auth",e)).data}))}auth2FA(e){return n(this,void 0,void 0,(function*(){return(yield this.axios.post("auth/2fa",e)).data}))}authRefresh(e,t){return n(this,void 0,void 0,(function*(){return(yield this.request({method:"post",url:"auth/refresh",data:{GrantType:"refresh_token",RedirectURI:"https://protonmail.com",RefreshToken:e,ResponseType:"token",State:u.getRandomString(24),UID:t}})).data}))}}t.ProtonmailClient=m},548:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.KeysRoutes=void 0;t.KeysRoutes=class{constructor(e){this.client=e}address(){return r(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:"addresses"})).data}))}users(){return r(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:"users"})).data}))}keySalts(){return r(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:"keys/salts"})).data}))}}},589:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LabelsRoutes=void 0;const o=r(367);t.LabelsRoutes=class{constructor(e){this.client=e}list(e){return n(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:`labels?${o.queryStringStringify(e)}`})).data}))}}},284:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabelType=t.DefaultLabels=void 0,function(e){e[e.Inbox=0]="Inbox",e[e.SelfSent=1]="SelfSent",e[e.Sent2=2]="Sent2",e[e.Trash=3]="Trash",e[e.Spam=4]="Spam",e[e.All=5]="All",e[e.Archive=6]="Archive",e[e.Sent=7]="Sent",e[e.Drafts=8]="Drafts",e[e.Starred=10]="Starred"}(t.DefaultLabels||(t.DefaultLabels={})),function(e){e[e.Label=1]="Label",e[e.Folder=2]="Folder"}(t.LabelType||(t.LabelType={}))},860:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesRoutes=void 0;const o=r(367),i=r(284);t.MessagesRoutes=class{constructor(e){this.client=e}list(e){return n(this,void 0,void 0,(function*(){const t=`messages?${o.queryStringStringify(e)}`;return(yield this.client.request({method:"get",url:t})).data}))}get(e){return n(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:`messages/${encodeURIComponent(e)}`})).data}))}count(){return n(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:"messages/count"})).data}))}markAsRead(e){return n(this,void 0,void 0,(function*(){return(yield this.client.request({method:"put",url:"messages/read",data:{IDs:e}})).data}))}markAsUnread(e){return n(this,void 0,void 0,(function*(){return(yield this.client.request({method:"put",url:"messages/unread",data:{IDs:e}})).data}))}label(e,t){return n(this,void 0,void 0,(function*(){return(yield this.client.request({method:"put",url:"messages/label",data:{IDs:e,LabelID:t}})).data}))}unlabel(e,t){return n(this,void 0,void 0,(function*(){return(yield this.client.request({method:"put",url:"messages/label",data:{IDs:e,LabelID:t}})).data}))}delete(e){return n(this,void 0,void 0,(function*(){return(yield this.client.request({method:"put",url:"messages/delete",data:{IDs:e,LabelID:i.DefaultLabels.Trash}})).data}))}}},963:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},666:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersRoutes=void 0;t.UsersRoutes=class{constructor(e){this.client=e}me(){return r(this,void 0,void 0,(function*(){return(yield this.client.request({method:"get",url:"users"})).data}))}}},501:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},312:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BCRYPT_PREFIX=t.SRP_MODULUS_KEY=t.MAX_VALUE_ITERATIONS=t.AUTH_VERSION=t.AUTH_FALLBACK_VERSION=t.SRP_LEN=t.VERIFICATION_STATUS=void 0,t.VERIFICATION_STATUS={NOT_SIGNED:0,SIGNED_AND_VALID:1,SIGNED_AND_INVALID:2},t.SRP_LEN=2048,t.AUTH_FALLBACK_VERSION=2,t.AUTH_VERSION=4,t.MAX_VALUE_ITERATIONS=1e3,t.SRP_MODULUS_KEY="-----BEGIN PGP PUBLIC KEY BLOCK-----\n\nxjMEXAHLgxYJKwYBBAHaRw8BAQdAFurWXXwjTemqjD7CXjXVyKf0of7n9Ctm\nL8v9enkzggHNEnByb3RvbkBzcnAubW9kdWx1c8J3BBAWCgApBQJcAcuDBgsJ\nBwgDAgkQNQWFxOlRjyYEFQgKAgMWAgECGQECGwMCHgEAAPGRAP9sauJsW12U\nMnTQUZpsbJb53d0Wv55mZIIiJL2XulpWPQD/V6NglBd96lZKBmInSXX/kXat\nSv+y0io+LR8i2+jV+AbOOARcAcuDEgorBgEEAZdVAQUBAQdAeJHUz1c9+KfE\nkSIgcBRE3WuXC4oj5a2/U3oASExGDW4DAQgHwmEEGBYIABMFAlwBy4MJEDUF\nhcTpUY8mAhsMAAD/XQD8DxNI6E78meodQI+wLsrKLeHn32iLvUqJbVDhfWSU\nWO4BAMcm1u02t4VKw++ttECPt+HUgPUq5pqQWe5Q2cW4TMsE\n=Y4Mw\n-----END PGP PUBLIC KEY BLOCK-----",t.BCRYPT_PREFIX="$2y$10$"},575:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateKeySalt=t.computeKeyPassword=void 0;const i=o(r(773)),s=o(r(784)),a=r(312);t.computeKeyPassword=(e,t)=>n(void 0,void 0,void 0,(function*(){if(!e||!t||24!==t.length||e.length<1)throw new Error("Password and salt required.");const r=Buffer.from(t,"base64");return(yield i.default.hash(e,a.BCRYPT_PREFIX+i.default.encodeBase64(r,16))).slice(29)}));t.generateKeySalt=()=>s.default(16).toString("base64")},310:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.hashPassword=t.expandHash=t.encodeUtf8=void 0;const i=o(r(773)),s=o(r(624)),a=r(689),u=r(312);t.encodeUtf8=e=>unescape(encodeURIComponent(e));t.expandHash=e=>n(void 0,void 0,void 0,(function*(){const t=[],r=Buffer.concat([e,Buffer.from([0])]);for(let e=1;e<=4;e++)t.push(s.default("sha512").update(r).digest()),r[r.length-1]=e;return Buffer.concat(yield Promise.all(t))}));const d=(e,r,o)=>n(void 0,void 0,void 0,(function*(){const n=yield i.default.hash(e,u.BCRYPT_PREFIX+r);return t.expandHash(Buffer.concat([Buffer.from(n),o]))})),c=(e,r,o)=>n(void 0,void 0,void 0,(function*(){const n=Buffer.from(t.encodeUtf8(r.toLowerCase())),i=s.default("md5").update(n).digest("hex");return d(e,i,o)}));t.hashPassword=({password:e,salt:r,username:o,modulus:u,version:l})=>{if(4===l||3===l)return((e,t,r)=>{const n=Buffer.from(t+"proton","binary");return d(e,i.default.encodeBase64(n,16),r)})(e,r,u);if(2===l)return c(e,a.cleanUsername(o),u);if(1===l)return c(e,o,u);if(0===l)return((e,r,o)=>n(void 0,void 0,void 0,(function*(){const n=s.default("sha512").update(Buffer.from(r.toLowerCase()+t.encodeUtf8(e))).digest("base64");return c(n,r,o)})))(e,o,u);throw new Error("Unsupported auth version")}},273:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getSrp=t.generateProofs=t.srpHasher=void 0;const i=o(r(224)),s=o(r(784)),a=r(310),u=r(762),d=r(312),c=r(287),l=new i.default(0),h=new i.default(1),f=new i.default(2);t.srpHasher=e=>a.expandHash(e);const p=e=>{return u.toBN((t=Buffer.alloc(e/8),s.default(t.length)));var t},v=({len:e,generator:r,modulus:o,serverEphemeralArray:s})=>n(void 0,void 0,void 0,(function*(){const n=(e=>{const t=new i.default(2*e);for(let r=0;r<d.MAX_VALUE_ITERATIONS;++r){const r=p(e);if(!r.isLessThanOrEqualTo(t))return r}throw new Error("Could not find safe client value")})(e),a=r.exponentiatedBy(n,o),c=u.fromBN(e,a),l=yield t.srpHasher(Buffer.concat([c,s]));return{clientSecret:n,clientEphemeral:a,scramblingParam:u.toBN(l)}}));t.generateProofs=({len:e,modulusArray:r,hashedPasswordArray:o,serverEphemeralArray:s})=>n(void 0,void 0,void 0,(function*(){const a=u.toBN(r),c=f,p=yield t.srpHasher(Buffer.concat([u.fromBN(e,c),r])),y=u.toBN(p),m=u.toBN(s),g=u.toBN(o),_=new i.default(a),w=_.minus(h),P=y.mod(_);if(P.isLessThanOrEqualTo(h)||P.isGreaterThanOrEqualTo(w))throw new Error("SRP multiplier is out of bounds");if(c.isLessThanOrEqualTo(h)||c.isGreaterThanOrEqualTo(w))throw new Error("SRP generator is out of bounds");if(m.isLessThanOrEqualTo(h)||m.isGreaterThanOrEqualTo(w))throw new Error("SRP server ephemeral is out of bounds");const{clientSecret:E,clientEphemeral:T,scramblingParam:A}=yield(({len:e,generator:t,modulus:r,serverEphemeralArray:o})=>n(void 0,void 0,void 0,(function*(){for(let n=0;n<d.MAX_VALUE_ITERATIONS;++n){const{clientSecret:n,clientEphemeral:i,scramblingParam:s}=yield v({len:e,generator:t,modulus:r,serverEphemeralArray:o});if(!s.isEqualTo(l))return{clientSecret:n,clientEphemeral:i,scramblingParam:s}}throw new Error("Could not find safe parameters")})))({len:e,generator:c,modulus:_,serverEphemeralArray:s});let S=m.minus(c.exponentiatedBy(g,_).multipliedBy(P).mod(_));S.isLessThan(l)&&(S=S.plus(_));const b=A.multipliedBy(g).plus(E).modulo(_.minus(h)),I=S.exponentiatedBy(b,_),x=u.fromBN(e,T),R=u.fromBN(e,I),B=yield t.srpHasher(Buffer.concat([x,s,R]));return{clientEphemeral:x,clientProof:B,expectedServerProof:yield t.srpHasher(Buffer.concat([x,B,R])),sharedSession:R}}));t.getSrp=({Version:e,Modulus:r,ServerEphemeral:o,Username:i,Salt:s},{password:u},l=e)=>n(void 0,void 0,void 0,(function*(){const e=yield c.getModulusWithoutVerification(r),n=Buffer.from(o,"base64"),h=yield a.hashPassword({version:l,password:u,salt:l<3?void 0:Buffer.from(s,"base64").toString("binary"),username:l<3?i:void 0,modulus:e}),{clientEphemeral:f,clientProof:p,expectedServerProof:v,sharedSession:y}=yield t.generateProofs({len:d.SRP_LEN,modulusArray:e,hashedPasswordArray:h,serverEphemeralArray:n});return{clientEphemeral:f.toString("base64"),clientProof:p.toString("base64"),expectedServerProof:v.toString("base64"),sharedSession:y}}))},762:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fromBN=t.toBN=void 0;const o=n(r(224));t.toBN=e=>{const t=Buffer.alloc(e.length);for(let r=0;r<e.length;r++)t[e.length-r-1]=e[r];return new o.default(t.toString("hex"),16)};t.fromBN=(e,t)=>{let r=t.toString(16);r.length%2!=0&&(r=`0${r}`);const n=Buffer.from(r,"hex"),o=new Buffer(e/8);for(let e=0;e<n.length;e++)o[n.length-e-1]=n[e];return o}},287:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getModulusWithoutVerification=void 0;t.getModulusWithoutVerification=e=>r(void 0,void 0,void 0,(function*(){const t=e.split("\n").find((e=>e.length>60));if(void 0===t)throw new Error(`could not extract modulus from ${e}`);return Buffer.from(t,"base64")}))},689:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cleanUsername=void 0;t.cleanUsername=(e="")=>e.replace(/[.\-_]/g,"").toLowerCase()},376:e=>{e.exports=require("axios")},773:e=>{e.exports=require("bcryptjs")},224:e=>{e.exports=require("bignumber.js")},624:e=>{e.exports=require("create-hash")},614:e=>{e.exports=require("events")},549:e=>{e.exports=require("openpgp")},784:e=>{e.exports=require("randombytes")}},t={};return function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(620)})()}));
//# sourceMappingURL=index.js.map